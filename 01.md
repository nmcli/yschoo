------

> ì˜¤í”ˆì‹œí”„íŠ¸ ì„¤ì¹˜ ë²„ì „ : 4.11.18 ì„¤ì¹˜ ë°©ì‹ : UPI(User Provisioned Infrastructure)

------

- ëª©ì°¨

------

# ì‚¬ì „ í™˜ê²½ ì„¤ì •

## 1. ìƒˆ ë¶„ì‚° í¬íŠ¸ ê·¸ë£¹ ìƒì„±(Disconnected OCPìš©)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e9907746-0427-4a4c-a907-43d9ae191126/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1369368e-2ceb-4906-81a5-bbc2bb98bd12/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/eb7ebefa-0922-44e1-a8d9-298ca2f65bab/Untitled.png)

â€» VLAN ìƒì„±ì‹œ VLAN ìœ í˜• ì„¤ì •(OCP ì„¤ì¹˜ í›„ ë„¤íŠ¸ì›Œí¬ ë³€ê²½ ë¶ˆê°€)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9d75c724-c9b9-40bc-a5fb-ab131a725546/Untitled.png)

------

# íŒŒì¼ ì¤€ë¹„

## 2. silo(ì €ì¥ì†Œ) ì„¤ì •

<aside> ğŸ’¡ [hostname] silo [IP] ens192(DP_10_50_3) : 10.50.3.155 - terminal, download, ext

# ì™¸ë¶€ ì ‘ì†ìš©

ens224(DP_for_hanabank) : 10.229.111.30 - upload, int

# ë…¸ë“œ ì—…ë¡œë“œìš©(for bastion)

[etc] SELinux & firewalld disabled / local repository / LVM(datavg-quaylv)

</aside>

### 2-1. ìµœì‹  RHEL 8.6 REPOSITORY íŒŒì¼ ì¤€ë¹„

```bash
subscription-manager register
---
Registering to: subscription.rhsm.redhat.com:443/subscription
Username: [hwcho@metanet.co.kr]
Password: [comas123]
---
subscription-manager list --available
subscription-manager attach --pool 8a85f99c7ebb2fb6017ebf86448642b3
subscription-manager repos --list
subscription-manager release --set=8.6 && rm -rf /var/cache/dnf

yum install yum-utils createrepo -y

mkdir sh
cd sh
echo "mkdir -p /data/repo/
reposync --gpgcheck --newest-only --repoid=rhel-8-for-x86_64-baseos-rpms  --download-path=/data/repo/ --downloadcomps --download-metadata
reposync --gpgcheck --newest-only --repoid=rhel-8-for-x86_64-appstream-rpms --download-path=/data/repo/ --downloadcomps --download-metadata
reposync --gpgcheck --newest-only --repoid=rhocp-4.11-for-rhel-8-x86_64-rpms --download-path=/data/repo/ --downloadcomps --download-metadata
reposync --gpgcheck --newest-only --repoid=fast-datapath-for-rhel-8-x86_64-rpms --download-path=/data/repo/ --downloadcomps --download-metadata
createrepo /data/repo/rhel-8-for-x86_64-baseos-rpms/ -g comps.xml
createrepo /data/repo/rhel-8-for-x86_64-appstream-rpms/ -g comps.xml
createrepo /data/repo/rhocp-4.11-for-rhel-8-x86_64-rpms / -g comps.xml
createrepo /data/repo/fast-datapath-for-rhel-8-x86_64-rpms/ -g comps.xml" > "repo_down.sh"

sh -x 01.repo_down.sh
```

## 3. RHOCP ì„¤ì¹˜ì‹œ í•„ìš”í•œ íŒŒì¼ ì™¸ë¶€ ë‹¤ìš´ë¡œë“œ(4.11.18 ê¸°ì¤€)

<aside> ğŸ’¡ oc(OpenShift CLI) ëª…ë ¹ì–´ openshift-install ëª…ë ¹ì–´ oc-mirror í”ŒëŸ¬ê·¸ì¸ rhcos(Red Hat CoreOS) iso(BareMetal) íŒŒì¼

</aside>

### 3-1. oc(OpenShift CLI) ëª…ë ¹ì–´

```bash
mkdir -p /data/ocp41118/
# ocp 4.11.18ìš© ë‹¤ìš´ë¡œë“œ ë””ë ‰í„°ë¦¬ ìƒì„±
cd /data/ocp41118/
curl -L <https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.11.18/openshift-client-linux-4.11.18.tar.gz> -o openshift-client-linux-4.11.18.tar.gz
# oc ëª…ë ¹ì–´ 4.11.18 ë²„ì „ ë‹¤ìš´ë¡œë“œ (<https://console.redhat.com/openshift/downloads>)
tar xvf openshift-client-linux-4.11.18.tar.gz -C /usr/local/sbin/
# ì™¸ë¶€ ëª…ë ¹ì–´ í’€ê¸°
```

### 3-2. openshift-install ëª…ë ¹ì–´

```bash
curl -L <https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.11.18/openshift-install-linux-4.11.18.tar.gz> -o openshift-install-linux-4.11.18.tar.gz
# openshift-install 4.11.18 ë²„ì „ ë‹¤ìš´ë¡œë“œ (<https://console.redhat.com/openshift/downloads>)
tar xvf openshift-install-linux-4.11.18.tar.gz -C /usr/local/sbin/
# ì™¸ë¶€ ëª…ë ¹ì–´ í’€ê¸°
```

### 3-3. oc-mirror plug-in ì„¤ì¹˜

```bash
curl -L <https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.11.18/oc-mirror.tar.gz> -o oc-mirror.tar.gz
# oc-mirror 4.11.18 ë²„ì „ ë‹¤ìš´ë¡œë“œ
tar xvf oc-mirror.tar.gz -C /usr/local/sbin/
# ì™¸ë¶€ ëª…ë ¹ì–´ í’€ê¸°
chmod +x /usr/local/sbin/oc-mirror
# oc mirror ì‹¤í–‰ ê¶Œí•œ ì£¼ê¸°
oc mirror help
# ì‹¤í–‰ í™•ì¸
```

â€»  ë°˜ë“œì‹œ ë¯¸ëŸ¬ë§ í•  ì´ë¯¸ì§€ì™€ ë²„ì „ì´ ê°™ì€ openshift-install ë‹¤ìš´ë¡œë“œ

### 3-4. rhcos iso íŒŒì¼ ë‹¤ìš´ë¡œë“œ

```bash
curl -L <https://mirror.openshift.com/pub/openshift-v4/x86_64/dependencies/rhcos/4.11/latest/rhcos-4.11.9-x86_64-live.x86_64.iso> -o rhcos-4.11.9-x86_64-live.x86_64.iso
# rhcos 4.11 ì¤‘ ìµœì‹  iso íŒŒì¼ ë‹¤ìš´ë¡œë“œ (2023/01ì›” ê¸°ì¤€ 4.11.9)
```

â€»  CoreOSëŠ” ëª¨ë“  ë¦´ë¦¬ì¦ˆì— ë³€ê²½ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ, OCP ë²„ì „ë³´ë‹¤ ê°™ê±°ë‚˜ ë‚®ì€ ë²„ì „ ì¤‘ ê°€ì¥ ë†’ì€ ë²„ì „(í•„ìˆ˜ëŠ” ì•„ë‹˜)ì„ ë‹¤ìš´ë¡œë“œí•´ì•¼ í•œë‹¤.

### 3-4-1. rhcos iso íŒŒì¼ ì—…ë¡œë“œ

LOCAL PCì— ë‹¤ìš´ë¡œë“œ

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/17b972b9-7328-4066-add3-46c3f9fb1723/Untitled.png)

ESXi í˜¸ìŠ¤íŠ¸ ì§ì ‘ ì ‘ì†(http://172.16.41.31) - ex) ESXi

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c429eb08-8b5c-464a-9828-8a74d06eaa72/Untitled.png)

ID/PW ì…ë ¥(root/VMware1!)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/87db6712-83b6-47b7-a56e-92daffb06ca5/Untitled.png)

ESXi í˜¸ìŠ¤íŠ¸ Datastore iso íŒŒì¼ ì—…ë¡œë“œ

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/57dc85a2-137e-4495-8374-45bf1c0ddc48/Untitled.png)

### 3-5. ì„¤ì¹˜ í•„ìš” íŒŒì¼ í†µí•© ë‹¤ìš´ë¡œë“œ

```bash
echo "mkdir -p /data/ocp41118/
cd /data/ocp41118/
curl -L <https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.11.18/openshift-client-linux-4.11.18.tar.gz> -o openshift-client-linux-4.11.18.tar.gz
curl -L <https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.11.18/openshift-install-linux-4.11.18.tar.gz> -o openshift-install-linux-4.11.18.tar.gz
curl -L <https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.11.18/oc-mirror.tar.gz> -o oc-mirror.tar.gz
curl -L <https://mirror.openshift.com/pub/openshift-v4/x86_64/dependencies/rhcos/4.11/latest/rhcos-4.11.9-x86_64-live.x86_64.iso> -o rhcos-4.11.9-x86_64-live.x86_64.iso
tar xvf openshift-client-linux-4.11.18.tar.gz -C /usr/local/sbin/
tar xvf openshift-install-linux-4.11.18.tar.gz -C /usr/local/sbin/
tar xvf oc-mirror.tar.gz -C /usr/local/sbin/
chmod +x /usr/local/sbin/oc-mirror
cd /root/sh/" > "02.ocp_cmd_down.sh"

sh -x 02.ocp_cmd_down.sh
```

------

# ë ˆì§€ìŠ¤íŠ¸ë¦¬ ë¯¸ëŸ¬

## 4. mirror-registry êµ¬ì¶•

### 4-1. mirror-registry ì„¤ì¹˜

```bash
yum install podman -y
# podman ì„¤ì¹˜

mv /root/sh

echo "mkdir -p /data/oc-img/
cd /data/oc-img/
curl -L <https://developers.redhat.com/content-gateway/rest/mirror/pub/openshift-v4/clients/mirror-registry/latest/mirror-registry.tar.gz> -o mirror-registry.tar.gz
tar xvf mirror-registry.tar.gz
mv mirror-registry.tar.gz /data/ocp41118/
echo '127.0.0.1 registry.ocpcsm.hanabank.com' >> /etc/hosts
# ë‚´ë¶€ dnsëŠ” ì™¸ë¶€ ì£¼ì†Œë¡œ ì¿¼ë¦¬ê°€ ë˜ì§€ ì•Šì•„ ì¼ì‹œì ìœ¼ë¡œ ì„¤ì •(ì„ì‹œ í™˜ê²½ì´ê¸°ì— ì•„ë¬´ í˜¸ìŠ¤íŠ¸ë„¤ì„ ì‚¬ìš© ê°€ëŠ¥ --quayHostnameê³¼ ë™ì¼)
./mirror-registry install --initUser admin --initPassword admin123 --quayHostname registry.ocpcsm.hanabank.com --quayRoot /quay
# quay ì„¤ì¹˜" > "03.quay_install.sh"

sh -x 03.quay_install.sh
```

ì„¤ì¹˜ê°€ ì„±ê³µí•˜ë©´ ë§ˆì§€ë§‰ì— ID, PW ì¶œë ¥

```bash
INFO[2023-01-13 15:34:48] Quay installed successfully, permanent data is stored in /quay 
INFO[2023-01-13 15:34:48] Quay is available at <https://registry.ocpcsm.hanabank.com:8443> with credentials (admin, admin123)
```

podman í™•ì¸

```bash
CONTAINER ID  IMAGE                                                    COMMAND         CREATED             STATUS                 PORTS                   NAMES
d34bd391ce50  registry.access.redhat.com/ubi8/pause:8.6-21             infinity        2 minutes ago       Up 2 minutes ago       0.0.0.0:8443->8443/tcp  503cb0cbe0a0-infra
1d3f5b0ed478  registry.redhat.io/rhel8/postgresql-10:1-202.1666660384  run-postgresql  2 minutes ago       Up 2 minutes ago       0.0.0.0:8443->8443/tcp  quay-postgres
802a914a229c  registry.redhat.io/rhel8/redis-6:1-88.1666660352         run-redis       2 minutes ago       Up 2 minutes ago       0.0.0.0:8443->8443/tcp  quay-redis
109bd1c86e65  registry.redhat.io/quay/quay-rhel8:v3.7.10               registry        About a minute ago  Up About a minute ago  0.0.0.0:8443->8443/tcp  quay-app
```

### 4-1-1. mirror-registry ì„¤ì¹˜ ì‹¤íŒ¨ ì‹œ ì‚­ì œ ë°©ë²•

```bash
./mirror-registry uninstall -v --quayRoot /quay
```

### 4-2. quay ì ‘ì† í…ŒìŠ¤íŠ¸

```bash
podman login --authfile test.txt -u admin -p admin123 registry.ocpcsm.hanabank.com:8443 --tls-verify=false
```

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/bd72116d-a265-4cbe-996e-7fa79f6bf143/Untitled.png)

ì¸ì¦ì„œ ë“±ë¡

```bash
cp /quay/quay-rootCA/rootCA.pem /usr/share/pki/ca-trust-source/anchors/
update-ca-trust
```

### 4-3. Credential êµ¬ì„±

https://console.redhat.com/openshift/install/pull-secret ì™¼ìª½ì˜ ë§í¬ ë“¤ì–´ê°€ì„œ pull secretì„ ë³µì‚¬í•˜ì—¬ pull_secretíŒŒì¼ì— ì €ì¥

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8c40ebf3-b4aa-45d3-a4fb-d886e84ae149/Untitled.png)

```bash
yum install jq -y
# jq ì„¤ì¹˜
cat pull_secret | jq . > pull_secret2
echo -n 'admin:admin123' | base64 -w0
# ID, PW ë³€ê²½
---
YWRtaW46YWRtaW4xMjM=
---
# ì¶œë ¥ê°’(test.txt)
```

<credentials>ì„ base64ë¡œ ì¸ì½”ë”©ëœ ê°’ìœ¼ë¡œ ìˆ˜ì • í›„ pull_secret2ì— ì¶”ê°€.

```bash
"auths": {
    "<mirror_registry>": { 
      "auth": "<credentials>", 
      "email": "you@example.com"
  },
```

ì™„ì„±ê°’ ì˜ˆì‹œ

```bash
{
  "auths": {
    "cloud.openshift.com": {
      "auth": "b3BlbnNoaWZ0LXJlbGVhc2UtZGV2K29jbV9hY2Nlc3NfZDc5NDNmM2I4ZTEyNGIwNWI0NGY1Nzk1Y2U4MjFkZWM6RFk0VEtPR1oxWjZPMlk4UVJZUTREOVgyMjE1WkY4OEswTUVWVkFZVVAxSUdONkZPQ0ZYWlc1M09JSDdaWDRUTQ==",
      "email": "hwcho@metanet.co.kr"
# disconnect -> ì‚­ì œí•˜ê¸°
    },
    "quay.io": {
      "auth": "b3BlbnNoaWZ0LXJlbGVhc2UtZGV2K29jbV9hY2Nlc3NfZDc5NDNmM2I4ZTEyNGIwNWI0NGY1Nzk1Y2U4MjFkZWM6RFk0VEtPR1oxWjZPMlk4UVJZUTREOVgyMjE1WkY4OEswTUVWVkFZVVAxSUdONkZPQ0ZYWlc1M09JSDdaWDRUTQ==",
      "email": "hwcho@metanet.co.kr"
    },
    "registry.connect.redhat.com": {
      "auth": "fHVoYy1wb29sLTIzMWFiZDE1LTI4NDMtNGM0Mi04ZGRmLWQxZWIzZGFmZWE3MzpleUpoYkdjaU9pSlNVelV4TWlKOS5leUp6ZFdJaU9pSm1NV0ptTmpnNU1qbGhNVGcwTUdRMVlUTXhNbUk1T1dWbE5HSTRaVGt6TWlKOS5Dc21adXMzQjIzbklGTVZuSmZWSWJtWkFGUllRaWRmNzVHalV2azZWdHZvX0dFSHhsdTRrbmZaV1poRV9oOURDd21sWnNSMENrdlhXNU15RVV2bUpLZldpenFtbExlcHFULW1qUjZfejlxQ2Y4aFc0YXBuNmk2X3I4YXRURHh2NFVWQU5mNzFjRlZ0dnFuS0ppdVI3eC1yYmp0ZlZOS2wycE52cUlsU2NFaVdNeGgxejJKN2hVeUZ3VkRidm0yVjJNa0YtN3FPRVE5M0tjMll0SmN0NW9tZnBmU1ZEUWEteF8xd1kyNTNnbjlscE1hUElKQTBZZC1tZ2s5U3VYZ0l0U0lpRFJGNnR5V2c5amlMMFJ6MzVkQ2ZpeWVsTEpuZkstaUlwbEFBV0tzZnk2SUZscFkyamk5SVVWSFVYb0VaakdzVm9HM2YtRTUtOHRaLTZ5UnhnUjRXajgtWnZaR1Q3bUxFODBYdWRkNUliejBtYS1XZWZrUlRmcl81NklyelBPSzR5RkFzVnFrbWRwRzZWQmZpNzdhTGhwRW1JcVhkOTBITjhxM0tHZUctX1BDc011VUhPdnh2eVhkUlJQVXVER0Q3ZUh1WWNheW1TeF8tTF9Nc2hqdERHdkRkZVNfZW5RXzA3cU5NMEdJSXhlNDV6YjhtRWt0V3FVN2YzcFFmSUFIZ2pteW9jLWhXMEJDSHJLcThVTnN1LS1Qd1o5Y0UzSHhnNmVZSmdIcXRrQ0t6UkVTSDhwMERkM1FRVDU4cHZCNkZEUnJFLTNPRDZOamV0REJCbFQzakNvN09ha0lRenI5ekJTa1J4dDM4T09nM0lvN2s4b2FTaHVIQkFwR2hSU2tSTnlPaHBaamp0SzVvbHhLWE5lUWg1cXhMOV9aemF6ZXR6ZHZYd3ZvSQ==",
      "email": "hwcho@metanet.co.kr"
    },
    "registry.redhat.io": {
      "auth": "fHVoYy1wb29sLTIzMWFiZDE1LTI4NDMtNGM0Mi04ZGRmLWQxZWIzZGFmZWE3MzpleUpoYkdjaU9pSlNVelV4TWlKOS5leUp6ZFdJaU9pSm1NV0ptTmpnNU1qbGhNVGcwTUdRMVlUTXhNbUk1T1dWbE5HSTRaVGt6TWlKOS5Dc21adXMzQjIzbklGTVZuSmZWSWJtWkFGUllRaWRmNzVHalV2azZWdHZvX0dFSHhsdTRrbmZaV1poRV9oOURDd21sWnNSMENrdlhXNU15RVV2bUpLZldpenFtbExlcHFULW1qUjZfejlxQ2Y4aFc0YXBuNmk2X3I4YXRURHh2NFVWQU5mNzFjRlZ0dnFuS0ppdVI3eC1yYmp0ZlZOS2wycE52cUlsU2NFaVdNeGgxejJKN2hVeUZ3VkRidm0yVjJNa0YtN3FPRVE5M0tjMll0SmN0NW9tZnBmU1ZEUWEteF8xd1kyNTNnbjlscE1hUElKQTBZZC1tZ2s5U3VYZ0l0U0lpRFJGNnR5V2c5amlMMFJ6MzVkQ2ZpeWVsTEpuZkstaUlwbEFBV0tzZnk2SUZscFkyamk5SVVWSFVYb0VaakdzVm9HM2YtRTUtOHRaLTZ5UnhnUjRXajgtWnZaR1Q3bUxFODBYdWRkNUliejBtYS1XZWZrUlRmcl81NklyelBPSzR5RkFzVnFrbWRwRzZWQmZpNzdhTGhwRW1JcVhkOTBITjhxM0tHZUctX1BDc011VUhPdnh2eVhkUlJQVXVER0Q3ZUh1WWNheW1TeF8tTF9Nc2hqdERHdkRkZVNfZW5RXzA3cU5NMEdJSXhlNDV6YjhtRWt0V3FVN2YzcFFmSUFIZ2pteW9jLWhXMEJDSHJLcThVTnN1LS1Qd1o5Y0UzSHhnNmVZSmdIcXRrQ0t6UkVTSDhwMERkM1FRVDU4cHZCNkZEUnJFLTNPRDZOamV0REJCbFQzakNvN09ha0lRenI5ekJTa1J4dDM4T09nM0lvN2s4b2FTaHVIQkFwR2hSU2tSTnlPaHBaamp0SzVvbHhLWE5lUWg1cXhMOV9aemF6ZXR6ZHZYd3ZvSQ==",
      "email": "hwcho@metanet.co.kr"
    },
    "registry.ocpcsm.hanabank.com:8443": {
      "auth": "YWRtaW46YWRtaW4xMjM=",
      "email": "hwcho@metanet.co.kr"
    }
  }
}
```

jsonì„ ë‹¤ì‹œ í•œì¤„ë¡œ ë³€ê²½

```bash
cat pull_secret2 | jq . -c > pull_secret3
# í™•ì¸ì°¨ ì ê²€
```

## 5. OCP ì„¤ì¹˜ ì´ë¯¸ì§€ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ë‹¤ìš´ë¡œë“œ

### 5-1. imageset-config.yaml ìƒì„±

```bash
mkdir $XDG_RUNTIME_DIR/containers
cp pull_secret3 $XDG_RUNTIME_DIR/containers/auth.json
# pull_secret3 ë³µì‚¬(pull_secret2ì—¬ë„ ë¬´ë°©)
oc mirror init --registry registry.ocpcsm.hanabank.com:8443/mirror/oc-mirror-metadata > imageset-config.yaml
# ê¸°ë³¸ ì´ë¯¸ì§€ì…‹ ìƒì„±
```

### 5-2. imageset-config.yaml í™•ì¸(ê¸°ë³¸ê°’)

```bash
kind: ImageSetConfiguration
apiVersion: mirror.openshift.io/v1alpha2
storageConfig:
  registry:
    imageURL: registry.ocpcsm.hanabank.com:8443/mirror/oc-mirror-metadata
    skipTLS: false
mirror:
  platform:
    channels:
    - name: stable-4.11
      type: ocp
  operators:
  - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.12
    packages:
    - name: serverless-operator
      channels:
      - name: stable
  additionalImages:
  - name: registry.redhat.io/ubi8/ubi:latest
  helm: {}
```

### 5-2. imageset-config.yaml ìˆ˜ì •

```bash
kind: ImageSetConfiguration
apiVersion: mirror.openshift.io/v1alpha2
storageConfig:
  registry:
    imageURL: registry.ocpcsm.hanabank.com:8443/mirror/oc-mirror-metadata
    skipTLS: false
mirror:
  platform:
    channels:
    - name: stable-4.11 # 4.11.ì˜ ì•ˆì • ë²„ì „ ë‹¤ìš´ë¡œë“œ
      minVersion: 4.11.18 # 4.11.18 ë²„ì „ ì§€ì •
      maxVersion: 4.11.18 # 4.11.18 ë²„ì „ ì§€ì •
      type: ocp
    graph: true
# operators: ë°‘ë¶€ë¶„ ì‚­ì œ í›„ graph: ë¶€ë¶„ ì¶”ê°€
```

### 5-3. ì´ë¯¸ì§€ ì„¸íŠ¸ ë””ìŠ¤í¬ë¡œ ë¯¸ëŸ¬ë§

```bash
nohup bash -c '{ time oc mirror --ignore-history --config=/data/ocp41118/imageset-config.yaml file:///quay/mirror/ ; } 2>&1' > /data/ocp41118/mirror.log &
tail -f mirror.log
# mirror ë¡œê·¸ ì‹¤ì‹œê°„ í™•ì¸
```

### 5-3-1. ì´ë¯¸ì§€ ì„¸íŠ¸ ë¯¸ëŸ¬ë§ ì‹¤íŒ¨ì‹œ(ë©”íƒ€ë°ì´í„° ì‚­ì œ í›„ ì¬ì‹œë„ â†’ mirror_seq1_000000.tar)

QUAY ì›¹ ë¸Œë¼ìš°ì € ì ‘ì†

```bash
<https://172.16.43.200:8443>
```

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/0051e89f-42e4-4f44-a80a-67787bbc7618/Untitled.png)

QUAY ë¡œê·¸ì¸(ID : init PW : JXol2Lxnvb4698skgjG1Z3D0Eh5St7CV)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b984826d-672e-496a-88af-cc272f5cb699/Untitled.png)

mirror ê·¸ë£¹ í™•ì¸

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6f52f9ad-864a-4ea4-a511-73b969f212d2/Untitled.png)

mirror ê·¸ë£¹ ì„¤ì • â†’ Begin deletion

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d276469c-9992-4b5d-bedb-c010ebe7da3a/Untitled.png)

ê·¸ë£¹ ì‚­ì œ

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1b1be1c9-bfd1-405c-8ce8-937cf611af7d/Untitled.png)

ë””ë ‰í„°ë¦¬ ì‚­ì œ

```bash
rm -rf /quqy/mirror
# ë‹¤ìš´ë¡œë“œ ì¤‘ì´ì˜€ë˜ mirror ë””ë ‰í„°ë¦¬ ì‚­ì œ
rm -rf /run/user/0/containers
# ì´ë¯¸ì§€ ì„¸íŠ¸ ì¬ìƒì„±ì‹œ ì‚­ì œ(ì£¼ê¸°ì ìœ¼ë¡œ ë§Œë£Œë˜ì–´ ì—†ì–´ì§.)
```

### 5-4. ì´ë¯¸ì§€ ì„¸íŠ¸ í™•ì¸

ë¯¸ëŸ¬ë§ ì™„ë£Œ í›„ íŒŒì¼ í™•ì¸

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a8033f9d-50ce-4a00-9f77-a0fe45922416/Untitled.png)

### 5-5. ì‚¬ì „ ì¤€ë¹„ íŒŒì¼ ì••ì¶•

```bash
cd /root/sh/

echo "cd /data/
tar cvf ocp41118.tar ocp41118/
tar cvf rhel86_repo.tar repo/
tar cvf ocp_install_quay.tar /quay/
cd /root/sh" > "04.ocp_install_zip.sh"

sh -x 04.ocp_install_zip.sh
```

## 6. bastion ì„¤ì •

### 6-1. VM ìƒì„±

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1da9712b-be1e-4b8f-8bb0-7e128859533e/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9b50570b-ada0-40e3-9c14-c8875f8c899a/Untitled.png)

### 6-2. Bastion ê¸°ë³¸ ì„¤ì¹˜ ë° ì„¤ì •

<aside> ğŸ’¡ [hostname] [bastion.ocpcsm.hanabank.com](http://bastion.ocpcsm.hanabank.com) [IP] ens192(DP_for_hanabank) : 10.229.111.31 - deploy, int

# ë…¸ë“œ ë°°í¬ìš©

[etc] SELinux & firewalld disabled

</aside>

ë„¤íŠ¸ì›Œí¬ ë° í˜¸ìŠ¤íŠ¸ë„¤ì„ ì„¤ì •

```bash
nmcli con mod ens192 ipv4.address 10.229.111.31/24 ipv4.gateway 10.229.111.1 ipv4.dns 10.229.111.32,10.229.111.33 ipv4.method manual connection.autoconnect yes
nmcli con up ens192
# ens192 í¬íŠ¸ ì„¤ì •
nmcli con show
# í¬íŠ¸ í™œì„±í™” í™•ì¸

hostnamectl set-hostname bastion.ocpcsm.hanabank.com
bash
# hostname ì„¤ì • ë° ì ìš©
```

LVM ì„¤ì •

```bash
fdisk /dev/sdb
---
Command (m for help): n
Partition type
   p   primary (0 primary, 0 extended, 4 free)
   e   extended (container for logical partitions)
Select (default p): 

Using default response p.
Partition number (1-4, default 1): 
First sector (2048-419430399, default 2048): 
Last sector, +sectors or +size{K,M,G,T,P} (2048-419430399, default 419430399): 

Created a new partition 1 of type 'Linux' and of size 200 GiB.
Command (m for help): t
Selected partition 1
Hex code (type L to list all codes): 8e
Changed type of partition 'Linux' to 'Linux LVM'.
Command (m for help): w
---
pvcreate /dev/sdb1
vgcreate datavg /dev/sdb1
lvcreate -n quaylv -L +500GiB datavg
lvcreate -n datalv -l 100%FREE datavg
mkfs.xfs /dev/mapper/datavg-datalv
mkfs.xfs /dev/mapper/datavg-quaylv
mkdir /data
mkdir /quay
echo "/dev/mapper/datavg-quaylv /quay                       xfs     defaults        0 0
/dev/mapper/datavg-datalv /data                       xfs     defaults        0 0" >> "/etc/fstab"
mount -a
```

siloì—ì„œ ì‚¬ì „ ì¤€ë¹„ íŒŒì¼ ê°€ì ¸ì˜¤ê¸°

```bash
scp -r 10.229.111.30:/data/ocp41118.tar /data/
scp -r 10.229.111.30:/data/ocp_install_quay.tar /data/
scp -r 10.229.111.30:/data/rhel86_repo.tar /data/
```

LOCAL REPOSITOTY ì„¤ì •

```bash
tar xvf /data/rhel86_repo.tar -C /

echo "[BaseOS]
name=RHEL8-BaseOS
gpgcheck=0
enabled=1
metadata_expire=-1
baseurl=file:///repo/rhel-8-for-x86_64-baseos-rpms/

[AppStream]
name=RHEL8-AppStream
gpgcheck=0
enabled=1
metadata_expire=-1
baseurl=file:///repo/rhel-8-for-x86_64-appstream-rpms/

[RHOCP-4.11]
name=RHEL8-rhocp-4.11
gpgcheck=0
enabled=1
metadata_expire=-1
baseurl=file:///repo/rhocp-4.11-for-rhel-8-x86_64-rpms/

[DATAPATH]
name=RHEL8-fast-datapath
gpgcheck=0
enabled=1
metadata_expire=-1
baseurl=file:///repo/fast-datapath-for-rhel-8-x86_64-rpms/" > "/etc/yum.repos.d/rhocp.repo"
yum clean all
yum repolist -v
```

firewalld, selinux ë¹„í™œì„±í™”

```bash
systemctl disable firewalld --now
sed 's/SELINUX=enforcing/SELINUX=disabled/g' -i /etc/selinux/config
reboot
```

### 6-3. Bastion ì„¤ì¹˜ ì „ êµ¬ì„±

ì˜¤í”ˆì‹œí”„íŠ¸ ê´€ë ¨ ëª…ë ¹ì–´ ì••ì¶• í•´ì œ

```bash
cd /data/
tar xvf ocp41118.tar
```

ì˜¤í”ˆì‹œí”„íŠ¸ ê´€ë ¨ ëª…ë ¹ì–´ ë“±ë¡

```bash
cd /datas/ocp41118/
tar xvf openshift-client-linux-4.11.18.tar.gz -C /usr/local/sbin/
# oc(OpenShift CLI) ëª…ë ¹ì–´ í’€ê¸°
tar xvf openshift-install-linux-4.11.18.tar.gz -C /usr/local/sbin/
# openshift-install ëª…ë ¹ì–´ í’€ê¸°
tar xvf oc-mirror.tar.gz -C /usr/local/sbin/
# oc-mirror plug-in ëª…ë ¹ì–´ í’€ê¸°
chown root:root /usr/local/sbin/oc-mirror
# oc mirror root ì†Œìœ ê¶Œ ì£½ì£¼ê¸°
chmod +x /usr/local/sbin/oc-mirror
# oc mirror ì‹¤í–‰ ê¶Œí•œ ì£¼ê¸°
oc mirror help
# ì‹¤í–‰ í™•ì¸
```

ì˜¤í”ˆì‹œí”„íŠ¸ ë¯¸ëŸ¬ ëª…ë ¹ì–´ ì••ì¶• í•´ì œ(quay ì„¤ì¹˜ìš©)

```bash
mkdir -p /data/oc-img/
tar xvf /data/ocp41118/mirror-registry.tar.gz -C /data/oc-img/
```

local quay ì„¤ì¹˜

```bash
yum install podman -y

cd /data/oc-img/

echo '127.0.0.1 registry.ocpcsm.hanabank.com' >> /etc/hosts
./mirror-registry install --initUser admin --initPassword admin123 --quayHostname registry.ocpcsm.hanabank.com --quayRoot /quay
```

local quay ì„¤ì¹˜ ì •ë³´ íŒì—… í™•ì¸(ìŠ¤ëƒ…ìƒ·)

```bash
INFO[2023-01-16 10:59:25] Quay installed successfully, permanent data is stored in /quay 
INFO[2023-01-16 10:59:25] Quay is available at <https://registry.ocpcsm.hanabank.com:8443> with credentials (admin, admin123)
```

ì¸ì¦ì„œ ë“±ë¡

```bash
podman login -u admin -p admin123 registry.ocpcsm.hanabank.com:8443 --tls-verify=false
# podman login ì‹œ /run/user/0/containers ìƒì„±
cp /quay/quay-rootCA/rootCA.pem /usr/share/pki/ca-trust-source/anchors/
update-ca-trust
```

### 6-5. ì´ë¯¸ì§€ ì„¸íŠ¸ í‘¸ì‹œ

(ì»¨í…Œì´ë„ˆ ì¸ì¦ì„œ ë“±ë¡ - podman login ì•ˆí•  ì‹œ)

```bash
mkdir $XDG_RUNTIME_DIR/containers
cp pull_secret3 $XDG_RUNTIME_DIR/containers/auth.json
```

ocp ì„¤ì¹˜ íŒŒì¼ ì••ì¶• í’€ê¸° ë° ì´ë™

```bash
tar xvf /data/ocp_install_quay.tar
cp ./quay/mirror/mirror_seq1_000000.tar /quay/mirror
cd /quay/mirror
# ì¤€ë¹„í•œ ocp ì„¤ì¹˜ ì´ë¯¸ì§€ ì••ì¶• í’€ê¸° ë° ì´ë™
```

í‘¸ì‹œ

```bash
oc mirror --from=/quay/mirror/mirror_seq1_000000.tar docker://registry.ocpcsm.hanabank.com:8443/4.11
# QUAYì— 4.11 ë””ë ‰í„°ë¦¬ ìƒì„±í•˜ë©´ì„œ ì´ë¯¸ì§€ í‘¸ì‹œ, ëª…ë ¹ì–´ ì…ë ¥í•œ ê³³ì—ì„œ oc-mirror-workspace ë””ë ‰í„°ë¦¬ ìƒì„±
```

í‘¸ì‹œ ì™„ë£Œ ë¡œê·¸

```bash
info: Mirroring completed in 730ms (28.14MB/s)
Wrote release signatures to oc-mirror-workspace/results-1673938801
Writing image mapping to oc-mirror-workspace/results-1673938801/mapping.txt
Writing UpdateService manifests to oc-mirror-workspace/results-1673938801
Writing ICSP manifests to oc-mirror-workspace/results-1673938801
```

## 7. HAproxy êµ¬ì¶•

### 7-1. haproxy ì„¤ì¹˜

```bash
yum install haproxy -y
```

### 7-2. ***\*haproxy.cfg\**** ìˆ˜ì •

```bash
#---------------------------------------------------------------------
# Example configuration for a possible web application.  See the
# full configuration options online.
#
#   <https://www.haproxy.org/download/1.8/doc/configuration.txt>
#
#---------------------------------------------------------------------

#---------------------------------------------------------------------
# Global settings
#---------------------------------------------------------------------
global
    # to have these messages end up in /var/log/haproxy.log you will
    # need to:
    #
    # 1) configure syslog to accept network log events.  This is done
    #    by adding the '-r' option to the SYSLOGD_OPTIONS in
    #    /etc/sysconfig/syslog
    #
    # 2) configure local2 events to go to the /var/log/haproxy.log
    #   file. A line like the following can be added to
    #   /etc/sysconfig/syslog
    #
    #    local2.*                       /var/log/haproxy.log
    #
    log         127.0.0.1 local2

    chroot      /var/lib/haproxy
    pidfile     /var/run/haproxy.pid
    maxconn     4000
    user        haproxy
    group       haproxy
    daemon

    # turn on stats unix socket
    stats socket /var/lib/haproxy/stats

    # utilize system-wide crypto-policies
    ssl-default-bind-ciphers PROFILE=SYSTEM
    ssl-default-server-ciphers PROFILE=SYSTEM

#---------------------------------------------------------------------
# common defaults that all the 'listen' and 'backend' sections will
# use if not designated in their block
#---------------------------------------------------------------------
defaults
    mode                    http
    log                     global
    option                  httplog
    option                  dontlognull
    option http-server-close
    option forwardfor       except 127.0.0.0/8
    option                  redispatch
    retries                 3
    timeout http-request    10s
    timeout queue           1m
    timeout connect         10s
    timeout client          1m
    timeout server          1m
    timeout http-keep-alive 10s
    timeout check           10s
    maxconn                 3000

#---------------------------------------------------------------------
# main frontend which proxys to the backends
#---------------------------------------------------------------------
#frontend main
#    bind *:5000
#    acl url_static       path_beg       -i /static /images /javascript /stylesheets
#    acl url_static       path_end       -i .jpg .gif .png .css .js

#    use_backend static          if url_static
#    default_backend             app

#---------------------------------------------------------------------
# static backend for serving up images, stylesheets and such
#---------------------------------------------------------------------
#backend static
#    balance     roundrobin
#    server      static 127.0.0.1:4331 check
#
#---------------------------------------------------------------------
# round robin balancing between the various backends
#---------------------------------------------------------------------

frontend openshift-api-server
    bind *:6443
    default_backend openshift-api-server
    mode tcp
    option tcplog

backend openshift-api-server
    balance source
    mode tcp
    server bootstrap 10.229.111.64:6443 check
    server master01 10.229.111.51:6443 check
    server master02 10.229.111.52:6443 check
    server master03 10.229.111.53:6443 check

frontend machine-config-server
    bind *:22623
    default_backend machine-config-server
    mode tcp
    option tcplog

backend machine-config-server
    balance source
    mode tcp
    server bootstrap 10.229.111.64:22623 check
    server master01 10.229.111.51:22623 check
    server master02 10.229.111.52:22623 check
    server master03 10.229.111.53:22623 check

frontend ingress-http
    bind *:80
    default_backend ingress-http
    mode tcp
    option tcplog

backend ingress-http
    balance source
    mode tcp
    server router01 10.229.111.57:80 check
    server router02 10.229.111.58:80 check

frontend ingress-https
    bind *:443
    default_backend ingress-https
    mode tcp
    option tcplog

backend ingress-https
    balance source
    mode tcp
    server router01 10.229.111.57:443 check
    server router02 10.229.111.58:443 check
```

### 7-3. haproxy í™œì„±í™” ë° ë“±ë¡

```bash
systemctl enable haproxy --now
# ì¡°ê±´ selinux -> disabled
```

------

# ì„¤ì¹˜ ì „ í™˜ê²½ êµ¬ì„±

<aside> ğŸ’¡ [environment]

- dns
- Web Server (apache)
- ntp(chrony)

</aside>

## 8. ë„ë©”ì¸ ë„¤ì„ ì„œë²„ êµ¬ì¶•

### 8-1. bind ì„¤ì¹˜(DNS01, DNS02 ê³µí†µ)

```bash
yum install bind -y
```

### 8-2. named.conf ìˆ˜ì •(DNS01, DNS02 ê³µí†µ)

ì•„ë˜ ìˆ˜ì •

```bash
vi /etc/named.conf

options {
        listen-on port 53 { 127.0.0.1; };
        allow-query     { localhost; };
        listen-on-v6 port 53 { ::1; };
}
#ê¸°ë³¸ê°’

options {
        listen-on port 53 { any; };
        allow-query     { any; };
        listen-on-v6 port 53 { none; };
}
#ë³€ê²½ê°’

:wq
```

### 8-3. named.conf ì¶”ê°€(DNS01, DNS02 ê³µí†µ)

ì•„ë˜ ì¶”ê°€

```bash
vi /etc/named.conf

zone "ocpcsm.hanabank.com." IN {
        type master;
        file "ocpcsm.hanabank.com.zone";
};

zone "111.229.10.in-addr.arpa." IN {
        type master;
        file "rev.ocpcsm.hanabank.com.zone";
};

:wq
```

### 8-4. ocpcsm.hanabank.com.zone ìƒì„±(DNS01)

ì•„ë˜ ìƒì„±

```bash
vi /var/named/ocpcsm.hanabank.com.zone

$TTL 1D
@       IN       SOA @     ns01.ocpcsm.hanabank.com. (
                        0      ; serial
                        1D              ; refresh
                        1H             ; retry
                        1W              ; expire
                        3H )            ; minimum

@        IN      NS      ns01.ocpcsm.hanabank.com.
@        IN      A       10.229.111.32

ns01.ocpcsm.hanabank.com.                 IN      A       10.229.111.32
ns02.ocpcsm.hanabank.com.                 IN      A       10.229.111.33

dns01.ocpcsm.hanabank.com.                 IN      A       10.229.111.32
dns02.ocpcsm.hanabank.com.                 IN      A       10.229.111.33

bastion.ocpcsm.hanabank.com.                 IN      A       10.229.111.31
registry.ocpcsm.hanabank.com.                 IN      A       10.229.111.31

api.ocpcsm.hanabank.com.                 IN      A       10.229.111.31
api-int.ocpcsm.hanabank.com.                 IN      A       10.229.111.31

*.apps.ocpcsm.hanabank.com.                 IN      A       10.229.111.31

bootstrap.ocpcsm.hanabank.com.                 IN      A       10.229.111.64

master01.ocpcsm.hanabank.com.                 IN      A       10.229.111.51
master02.ocpcsm.hanabank.com.                 IN      A       10.229.111.52
master03.ocpcsm.hanabank.com.                 IN      A       10.229.111.53

worker01.ocpcsm.hanabank.com.                 IN      A       10.229.111.62
worker02.ocpcsm.hanabank.com.                 IN      A       10.229.111.63

infra01.ocpcsm.hanabank.com.                 IN      A       10.229.111.54
infra02.ocpcsm.hanabank.com.                 IN      A       10.229.111.55
infra03.ocpcsm.hanabank.com.                 IN      A       10.229.111.56

router01.ocpcsm.hanabank.com.                 IN      A       10.229.111.57
router02.ocpcsm.hanabank.com.                 IN      A       10.229.111.58

logging01.ocpcsm.hanabank.com.                 IN      A       10.229.111.59
logging02.ocpcsm.hanabank.com.                 IN      A       10.229.111.60
logging03.ocpcsm.hanabank.com.                 IN      A       10.229.111.61

:wq
```

### 8-5. ocpcsm.hanabank.com.zone ìƒì„±(DNS02)

ì•„ë˜ ìƒì„±

```bash
vi /var/named/ocpcsm.hanabank.com.zone

$TTL 1D
@       IN       SOA @     ns02.ocpcsm.hanabank.com. (
                        0      ; serial
                        1D              ; refresh
                        1H             ; retry
                        1W              ; expire
                        3H )            ; minimum

@        IN      NS      ns02.ocpcsm.hanabank.com.
@        IN      A       10.229.111.33

ns01.ocpcsm.hanabank.com.                 IN      A       10.229.111.32
ns02.ocpcsm.hanabank.com.                 IN      A       10.229.111.33

dns01.ocpcsm.hanabank.com.                 IN      A       10.229.111.32
dns02.ocpcsm.hanabank.com.                 IN      A       10.229.111.33

bastion.ocpcsm.hanabank.com.                 IN      A       10.229.111.31
registry.ocpcsm.hanabank.com.                 IN      A       10.229.111.31

api.ocpcsm.hanabank.com.                 IN      A       10.229.111.31
api-int.ocpcsm.hanabank.com.                 IN      A       10.229.111.31

*.apps.ocpcsm.hanabank.com.                 IN      A       10.229.111.31

bootstrap.ocpcsm.hanabank.com.                 IN      A       10.229.111.64

master01.ocpcsm.hanabank.com.                 IN      A       10.229.111.51
master02.ocpcsm.hanabank.com.                 IN      A       10.229.111.52
master03.ocpcsm.hanabank.com.                 IN      A       10.229.111.53

worker01.ocpcsm.hanabank.com.                 IN      A       10.229.111.62
worker02.ocpcsm.hanabank.com.                 IN      A       10.229.111.63

infra01.ocpcsm.hanabank.com.                 IN      A       10.229.111.54
infra02.ocpcsm.hanabank.com.                 IN      A       10.229.111.55
infra03.ocpcsm.hanabank.com.                 IN      A       10.229.111.56

router01.ocpcsm.hanabank.com.                 IN      A       10.229.111.57
router02.ocpcsm.hanabank.com.                 IN      A       10.229.111.58

logging01.ocpcsm.hanabank.com.                 IN      A       10.229.111.59
logging02.ocpcsm.hanabank.com.                 IN      A       10.229.111.60
logging03.ocpcsm.hanabank.com.                 IN      A       10.229.111.61

:wq
```

### 8-6. rev.ocpcsm.hanabank.com.zone ìƒì„±(DNS01)

ì•„ë˜ ìƒì„±

```bash
vi /var/named/rev.ocpcsm.hanabank.com.zone

$TTL 1D
@       IN      SOA @     ns01.ocpcsm.hanabank.com. (
                        0      ; serial
                        1D              ; refresh
                        1H             ; retry
                        1W              ; expire
                        3H )            ; minimum
@        IN      NS      ns01.ocpcsm.hanabank.com.
@        IN      A       10.229.111.32
31.111.229.10.in-addr.arpa.                 IN      PTR       api.ocpcsm.hanabank.com.
31.111.229.10.in-addr.arpa.                 IN      PTR       api-int.ocpcsm.hanabank.com.

64.111.229.10.in-addr.arpa.                 IN      PTR       bootstrap.ocpcsm.hanabank.com.

51.111.229.10.in-addr.arpa.                 IN      PTR       master01.ocpcsm.hanabank.com.
52.111.229.10.in-addr.arpa.                 IN      PTR       master02.ocpcsm.hanabank.com.
53.111.229.10.in-addr.arpa.                 IN      PTR       master03.ocpcsm.hanabank.com.

62.111.229.10.in-addr.arpa.                 IN      PTR       worker01.ocpcsm.hanabank.com.
63.111.229.10.in-addr.arpa.                 IN      PTR       worker02.ocpcsm.hanabank.com.

54.111.229.10.in-addr.arpa.                 IN      PTR       infra01.ocpcsm.hanabank.com.
55.111.229.10.in-addr.arpa.                 IN      PTR       infra02.ocpcsm.hanabank.com.
56.111.229.10.in-addr.arpa.                 IN      PTR       infra03.ocpcsm.hanabank.com.

57.111.229.10.in-addr.arpa.                 IN      PTR       router01.ocpcsm.hanabank.com.
58.111.229.10.in-addr.arpa.                 IN      PTR       router02.ocpcsm.hanabank.com.

59.111.229.10.in-addr.arpa.                 IN      PTR       logging01.ocpcsm.hanabank.com.
60.111.229.10.in-addr.arpa.                 IN      PTR       logging02.ocpcsm.hanabank.com.
61.111.229.10.in-addr.arpa.                 IN      PTR       logging03.ocpcsm.hanabank.com.

:wq
```

### 8-7. rev.ocpcsm.hanabank.com.zone ìƒì„±(DNS02)

ì•„ë˜ ìƒì„±

```bash
vi /var/named/rev.ocpcsm.hanabank.com.zone

$TTL 1D
@       IN      SOA @     ns02.ocpcsm.hanabank.com. (
                        0      ; serial
                        1D              ; refresh
                        1H             ; retry
                        1W              ; expire
                        3H )            ; minimum
@        IN      NS      ns02.ocpcsm.hanabank.com.
@        IN      A       10.229.111.33
31.111.229.10.in-addr.arpa.                 IN      PTR       api.ocpcsm.hanabank.com.
31.111.229.10.in-addr.arpa.                 IN      PTR       api-int.ocpcsm.hanabank.com.

64.111.229.10.in-addr.arpa.                 IN      PTR       bootstrap.ocpcsm.hanabank.com.

51.111.229.10.in-addr.arpa.                 IN      PTR       master01.ocpcsm.hanabank.com.
52.111.229.10.in-addr.arpa.                 IN      PTR       master02.ocpcsm.hanabank.com.
53.111.229.10.in-addr.arpa.                 IN      PTR       master03.ocpcsm.hanabank.com.

62.111.229.10.in-addr.arpa.                 IN      PTR       worker01.ocpcsm.hanabank.com.
63.111.229.10.in-addr.arpa.                 IN      PTR       worker02.ocpcsm.hanabank.com.

54.111.229.10.in-addr.arpa.                 IN      PTR       infra01.ocpcsm.hanabank.com.
55.111.229.10.in-addr.arpa.                 IN      PTR       infra02.ocpcsm.hanabank.com.
56.111.229.10.in-addr.arpa.                 IN      PTR       infra03.ocpcsm.hanabank.com.

57.111.229.10.in-addr.arpa.                 IN      PTR       router01.ocpcsm.hanabank.com.
58.111.229.10.in-addr.arpa.                 IN      PTR       router02.ocpcsm.hanabank.com.

59.111.229.10.in-addr.arpa.                 IN      PTR       logging01.ocpcsm.hanabank.com.
60.111.229.10.in-addr.arpa.                 IN      PTR       logging02.ocpcsm.hanabank.com.
61.111.229.10.in-addr.arpa.                 IN      PTR       logging03.ocpcsm.hanabank.com.

:wq
```

### 8-8. DNS ìê¸° ìì‹ ìœ¼ë¡œ ë³€ê²½(DNS01, DNS02 ê³µí†µ)

```bash
nmcli con mod ens192 ipv4.dns 10.229.111.32,10.229.111.33 ipv4.method manual connection.autoconnect yes
# DNS server ìê¸° ìì‹ ìœ¼ë¡œ ë³€ê²½(ì´ì¤‘í™”ì´ë¯€ë¡œ ë‘ê°œ)
nmcli con down ens192 ; nmcli con up ens192
# ens192 í¬íŠ¸ ì¬ì‹œì‘
cat /etc/resolv.conf
# nameserver í™•ì¸
```

### 8-9. DNS ì†Œìœ ê¶Œ ìˆ˜ì •(DNS01, DNS02 ê³µí†µ)

```bash
chown root:named ocpcsm.hanabank.com.zone
chown root:named rev.ocpcsm.hanabank.com.zone
```

### 8-10. DNS í™œì„±í™” ë° ë“±ë¡(DNS01, DNS02 ê³µí†µ)

```bash
systemctl enable named --now
```

### 8-11. ë„ë©”ì¸ ì¡°íšŒ

```bash
yum install bind-utils -y
# ë„ë©”ì¸ ì¿¼ë¦¬ ëª…ë ¹ì–´ ì„¤ì¹˜
dig +short ns01.ocpcsm.hanabank.com
dig +short ns02.ocpcsm.hanabank.com
dig +short api.ocpcsm.hanabank.com
dig +short *.apps.ocpcsm.hanabank.com
dig +short dns01.ocpcsm.hanabank.com
dig +short dns02.ocpcsm.hanabank.com
dig +short bastion.ocpcsm.hanabank.com
# ì •ë°©í–¥ ì¡°íšŒ
```

## 9. ì›¹ ì„œë²„ êµ¬ì¶•

### 9-1. apache httpd ì„œë²„ì„¤ì¹˜

```bash
yum install httpd -y
```

### 9-2. httpd.conf  ìˆ˜ì •

ì•„ë˜ ìˆ˜ì •

```bash
vi /etc/httpd/conf/httpd.conf

Listen 80 -> #Listen 80
Listen 8080 # ì¶”ê°€
# firewalld stop & disable í•„ìˆ˜
```

### 9-3. OCP ë””ë ‰í„°ë¦¬ ìƒì„±

```bash
mkdir -p /var/www/html/ocp
chmod 777 /var/www/html/ocp
```

### 9-4. ì•„íŒŒì¹˜ httpd ì„œë²„ í™œì„±í™” ë° ë“±ë¡

```bash
systemctl enable httpd --now
curl <http://bastion.ocpcsm.hanabank.com:8080/>
# ê²½ë¡œ í™•ì¸
...
			<a href="<https://nginx.com>">NGINX&trade;</a> is a registered trademark of <a href="<https://www.f5.com>">F5 Networks, Inc.</a>.
	        </div>
	</body>
</html>
# ì¶œë ¥ê°’(ì •ìƒ)
```

## 10. ntp ì„œë²„ êµ¬ì¶•

### 10-1. chrony ì„¤ì¹˜

```bash
yum install chrony -y
```

### 10-2. ***\*chrony.conf\**** ìˆ˜ì •

```bash
vi /etc/chrony.conf

#pool 2.rhel.pool.ntp.org iburst -> pool 2.rhel.pool.ntp.org iburst ì£¼ì„ ì²˜ë¦¬
server 10.229.111.30 iburst
# ë™ê¸°í™”ë˜ì–´ ìˆëŠ” ntp ì„œë²„ ì„¤ì •

allow 10.229.111.0/24
# DP_hana ëŒ€ì—­ëŒ€ IP allow ì„¤ì •

:wq
```

### 10-3. chronyd í™œì„±í™” ë° ë“±ë¡

```bash
systemctl enable chronyd --now
```

### 10-4. chronyd ë™ê¸°í™” í™•ì¸

```bash
---
[root@bastion ~]# chronyc sources
MS Name/IP address         Stratum Poll Reach LastRx Last sample               
===============================================================================
^- 203.248.240.140               2   6    17     6    +95ms[  +95ms] +/-  137ms
^* 220.73.142.66                 2   6    17     7    +29us[ +195us] +/- 3309us
---
# ì¶œë ¥ê°’
```

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/831b6665-5827-4a3c-b371-1ff8346cbb48/Untitled.png)

------

# ì„¤ì¹˜ ì§„í–‰

## 11. UPI OCP ì„¤ì¹˜ ì „ ì§„í–‰ ì‚¬í•­

### 11-1. OCP ì„¤ì¹˜ ì´ë¯¸ì§€ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì¸ì¦ì„œ ê²½ë¡œ í™•ì¸

```bash
cat /quay/quay-config/ssl.cert
```

### 11-2. install-config.yaml íŒŒì¼ ì‘ì„±(ìŠ¤ëƒ…ìƒ·)

```bash
cd /var/www/html/
# ë°±ì—… yaml íŒŒì¼ ì‘ì„±í•  ë””ë ‰í„°ë¦¬ë¡œ ì´ë™
ssh-keygen
# install-config.yaml íŒŒì¼ ì‘ì„± ìœ„í•´ sshí‚¤ ìƒì„±
vi install-config.yaml.bak
# ë°±ì—… yaml íŒŒì¼ ì‘ì„±

apiVersion: v1
baseDomain: hanabank.com
compute:
- hyperthreading: Enabled
  name: worker
  replicas: 0
controlPlane:
  hyperthreading: Enabled
  name: master
  replicas: 3
metadata:
  name: ocpcsm
networking:
  clusterNetworks:
  - cidr: 10.230.0.0/17
    hostPrefix: 23
  networkType: OpenShiftSDN
  serviceNetwork:
  - 10.230.128.0/17
platform:
  none: {}
fips: false
pullSecret: '{"auths":{"registry.ocpcsm.hanabank.com:8443":{"auth":"YWRtaW46YWRtaW4xMjM="}}}'
sshKey: 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDSpLgpd4hamqbJm9p4DEBFSam9nqdqrRbwiyHneN3DyK1Gv7nFC+PhbrHPJ2P64Q5zWpt6zRFtfOejpID5vebvSMqPfm65VuKCeZtw/4rHml2TFcBCq6kKDYf0xah5c320CyWrd+JEDQJ7m4emc1Ij+6TJBFCMhDZndSFVReheCxrA4iOBAmW8x5nIAbFRLe9vFYEa46hQ9fcgiJqdFGHVReL0QVmSHRBDbbPKt9pbBZbJygNQgoyhrjFNUhnwilzqHM+Pskn/jwHtMdbag3myDlNreQ35PdwOHcZgVnE9TVmE7DYQo4ICw0k+pZMRyqhH/Xhs+TACzS+QaZTpQeD93XoEEmPWl4KB8WD767nSxedifFScEfVueCIfHAFKp1dUhZ1vXcZRzhIhr4UKCYPVnnfzsbZuQtnSKtkn2sbKdu7ppF7EBqkX7CuU9Z7mB8cAJYWnkGkERjWO75kSI7O7ISzLssfYmPzjuhGzThOAalj3NvpjYHUZA/qMK4DcpcE= root@bastion.ocpcsm.hanabank.com'
additionalTrustBundle: |
  -----BEGIN CERTIFICATE-----
  MIIDazCCAlOgAwIBAgIUNr1jggYY9JdngPSzoD/k46qbmL0wDQYJKoZIhvcNAQEL
  BQAwdjELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAlZBMREwDwYDVQQHDAhOZXcgWW9y
  azENMAsGA1UECgwEUXVheTERMA8GA1UECwwIRGl2aXNpb24xJTAjBgNVBAMMHHJl
  Z2lzdHJ5Lm9jcGNzbS5oYW5hYmFuay5jb20wHhcNMjMwMTE2MDE1ODA4WhcNMjQw
  MTA3MDE1ODA4WjAaMRgwFgYDVQQDDA9xdWF5LWVudGVycHJpc2UwggEiMA0GCSqG
  SIb3DQEBAQUAA4IBDwAwggEKAoIBAQC8xogTO7ow4LvK6elHHsTkn3dLIK/OLard
  BVeXmrscUzNGXdJqtxidBNVYndfh14Am7mR57RkGuq7OIR63WaNsnHMcUQpy8a/x
  kny5oX38wbS5X4GJKH2tvOZKLcXBkp5a9kDd45GyNLN4gQsP2VH+r7vTOXIJWht0
  sigBN8e+FW8Sob9VaPxD5Q92P085NuE7DvRX+4nTT/0bFXplNP+2wHpjyvYl7wa6
  qKzFoMkzPqldaQj4EQ06JJG4ubvME2fU4VoncIEH/OVh5lgq1WWhJoCaIyI1WdSD
  78dIWj34sPOPA4/JfLPAfc+H34lobpJ95y64/M2YNFkT4yxp0zvHAgMBAAGjTTBL
  MAsGA1UdDwQEAwIC5DATBgNVHSUEDDAKBggrBgEFBQcDATAnBgNVHREEIDAeghxy
  ZWdpc3RyeS5vY3Bjc20uaGFuYWJhbmsuY29tMA0GCSqGSIb3DQEBCwUAA4IBAQAt
  U+Rs7asVNH5Yah+xo2uB7QmgpKcAc407qy5VrSAWdDzwUcWaTeJ943huhnRLLbQ6
  Slujkywtdy6HhA8QUS1ap6RbHQEJla2H5L4NnCtcJVGb2YcGdDyCmaehpqqr7aU9
  3Z8GT862/Dt+cixz8uVBFmW+ccaiMu+oW2Nr/xI1ma/sPZqKt8iizGi9coHuDhKK
  KE3TKMgdeZcGA8bKtYUCm219Ul7xnxIVqwZpIsaNJgzCi0AEQtnu5PltMhQ1DeZe
  R5m7Ml4hnfJQdoBdAh9+VzT0WQNr0OkhePzHBhRGjPhUnotdOJdCMFLKVRNJ9XA7
  dzasDnaBQJbnivmS82dP
  -----END CERTIFICATE-----
  -----BEGIN CERTIFICATE-----
  MIID2zCCAsOgAwIBAgIUOhSm6yFCv8L5JQ8ALVUyXYterAQwDQYJKoZIhvcNAQEL
  BQAwdjELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAlZBMREwDwYDVQQHDAhOZXcgWW9y
  azENMAsGA1UECgwEUXVheTERMA8GA1UECwwIRGl2aXNpb24xJTAjBgNVBAMMHHJl
  Z2lzdHJ5Lm9jcGNzbS5oYW5hYmFuay5jb20wHhcNMjMwMTE2MDE1ODA2WhcNMjUx
  MTA1MDE1ODA2WjB2MQswCQYDVQQGEwJVUzELMAkGA1UECAwCVkExETAPBgNVBAcM
  CE5ldyBZb3JrMQ0wCwYDVQQKDARRdWF5MREwDwYDVQQLDAhEaXZpc2lvbjElMCMG
  A1UEAwwccmVnaXN0cnkub2NwY3NtLmhhbmFiYW5rLmNvbTCCASIwDQYJKoZIhvcN
  AQEBBQADggEPADCCAQoCggEBAK92WAetBT103CowThMyePAAir+gyV1da/xflkZG
  EIDFIXg/ly6mrocWoJT5jMNSPNFkD7qhVMPgPQBOEduaZFI9I4Yq7OdpFCfjPqh6
  SqPTl+Z3+6p6nTGYKmDsJdiV57HDbw7KA8nZOcz9qhBG0qelDGyYpXLawhsh0dYv
  osKa4jVqKxJVbTx2qFbL7mYFiGRSwomBuxVmfrQUaDm/0P/rN/lQY3tbLv+OFffA
  Dv6bvlIri5xA9ZhYa2otWmQAnUJMVcCEu1BFbKMiybY/SgVfqtUAHPlt10EC/xPk
  cHgp7Prbz1RlXRpIGUbVBsHZeoFtaL+vytJt7L9YLshHtysCAwEAAaNhMF8wCwYD
  VR0PBAQDAgLkMBMGA1UdJQQMMAoGCCsGAQUFBwMBMCcGA1UdEQQgMB6CHHJlZ2lz
  dHJ5Lm9jcGNzbS5oYW5hYmFuay5jb20wEgYDVR0TAQH/BAgwBgEB/wIBATANBgkq
  hkiG9w0BAQsFAAOCAQEAD/fd2J5bxAYf3IkoQfySMCn73R2UWtOIxOoOLNBd69Fb
  PZTpvHnpBcVmGQ8/SuBIeyW1ni0SgvaLNSy0t3rGLSIYgqzAfE4j3nRIP1LlClux
  jjpxV/xBlZBaffFsdj5xaYvIic8mwZqMPw6gsYcra4vlI2vhV5lw7XJ/kXHDZr8+
  Cb+ts+eZFx+n3dA+ig07bDAninD7Z+uZRBccGPEmkPFlP/JQatWKW8b1RTV7Wf1+
  ZVc7r5t+9ZpOeZmCmgkQi/2sqg/uXJGFG6cDTI1+4W+pnOOvG2NC+pxwWPSSeTUw
  iYtYCcmCkb2iEvK9/mlRUKW/iH65JNnUXsUo5F3XTA==
  -----END CERTIFICATE-----
imageContentSources:
  - mirrors:
    - registry.ocpcsm.hanabank.com:8443/4.11/openshift/release
    source: quay.io/openshift-release-dev/ocp-v4.0-art-dev
  - mirrors:
    - registry.ocpcsm.hanabank.com:8443/4.11/openshift/release-images
    source: quay.io/openshift-release-dev/ocp-release

## ì„¤ëª…
controlPlane:
  hyperthreading: Enabled
  name: master
  replicas: 3 -> ë°°í¬ë˜ëŠ” ë§ˆìŠ¤í„° ë…¸ë“œ ê°¯ìˆ˜ ì„¤ì •
# ìˆ˜ì • ë¶€ë¶„
pullSecret: -> ìœ„ ì°¸ê³ í•˜ì—¬ ìˆ˜ì •
sshKey: -> # cat /root/.ssh/id_rsa.pub
-----BEGIN CERTIFICATE----- ~ -----END CERTIFICATE----- -> # cat /quay/quay-config/ssl.cert
imageContentSources: -> #/quy/mirror/oc-mirror-workspace/results-1673938801/imageContentSourcePolicy.yaml(ì„¤ì¹˜ ì´ë¯¸ì§€ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ë¡œë“œ ì„±ê³µì‹œ ìƒì„±)
```

### 11-3. ì´ê·¸ë‹ˆì…˜ íŒŒì¼ ìƒì„±

```bash
cp install-config.yaml.bak /var/www/html/ocp/install-config.yaml
# ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ìƒì„±ì‹œ install-config.yamlì´ ì‚­ì œë˜ë¯€ë¡œ ë°±ì—…ì„ ìœ„í•¨
openshift-install create manifests --dir=/var/www/html/ocp
# ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ìƒì„±
# ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ìƒì„± ìˆœê°„ 24ì‹œê°„ë™ì•ˆ ìœ íš¨í•˜ë‹¤. /var/www/html/ocp ë””ë ‰í„°ë¦¬ ë°‘ì— ìˆ¨ê¹€ íŒŒì¼ ì¡´ì¬í•˜ë¯€ë¡œ ì‚­ì œí•˜ê±°ë‚˜ ocp ë””ë ‰í„°ë¦¬ë¥¼ ì‚­ì œ(ì¬ìƒì„±ì´ í•„ìš”í•  ë•Œ)
cd /var/www/html/ocp/manifests/
# cluster-scheduler-02-config -> mastersSchedulable true -> falseë¡œ ì¹˜í™˜
vi cluster-scheduler-02-config.yml
# mastersSchedulable: true -> mastersSchedulable: false
# ë˜ëŠ”
sed -i 's/mastersSchedulable: true/mastersSchedulable: false/g' cluster-scheduler-02-config.yml
ë¡œ ì¹˜í™˜
openshift-install create ignition-configs --dir=/var/www/html/ocp/
# ì´ê·¸ë‹ˆì…˜ ìƒ˜í”Œ íŒŒì¼ ìƒì„±
```

### 11-4. ì´ê·¸ë‹ˆì…˜ íŒŒì¼ ìˆ˜ì •

ì´ê·¸ë‹ˆì…˜ íŒŒì¼ ê²½ë¡œë¡œ ì´ë™

```bash
cd /var/www/html/ocp/
```

boostrap ì´ê·¸ë‹ˆì…˜ íŒŒì¼ ìˆ˜ì •

```bash
cat bootstrap.ign | jq . > b.ign

vi b.ign

  "storage": {
    "files": [
# ì¶”ê°€
      {
        "overwrite": true,
        "path": "/etc/hostname",
        "user": {
          "name": "root"
        },
        "contents": {
          "source": "data:,bootstrap.ocpcsm.hanabank.com"
        },
        "mode": 420
      },
# ì¶”ê°€
      { 
        "overwrite": true,
        "path": "/etc/containers/registries.conf",
        "user": {
          "name": "root"
```

master ì´ê·¸ë‹ˆì…˜ íŒŒì¼ ìˆ˜ì •

```bash
cat master.ign | jq . > m1.ign

vi m1.ign

"version": "3.2.0"
  },-> # ì¶”ê°€
  "storage": {
    "files": [
      {
        "overwrite": true,
        "path": "/etc/hostname",
        "user": {
          "name": "root"
        },
        "contents": {
          "source": "data:,master01.ocpcsm.hanabank.com"
        },
        "mode": 384
      }
    ]
  }
# ì¶”ê°€
}

cp m1.ign m2.ign
cp m2.ign m3.ign
```

router ì´ê·¸ë‹ˆì…˜ íŒŒì¼ ìˆ˜ì •

```bash
cat worker.ign | jq . > r1.ign

vi r1.ign

"version": "3.2.0"
  },> # ì¶”ê°€
  "storage": {
    "files": [
      {
        "overwrite": true,
        "path": "/etc/hostname",
        "user": {
          "name": "root"
        },
        "contents": {
          "source": "data:,router01.ocpcsm.hanabank.com"
        },
        "mode": 384
      }
    ]
  }
# ì¶”ê°€
}

cp r1.ign r2.ign
```

worker ì´ê·¸ë‹ˆì…˜ íŒŒì¼ ìˆ˜ì •

```bash
cat worker.ign | jq . > w1.ign

vi w1.ign

"version": "3.2.0"
  },> # ì¶”ê°€
  "storage": {
    "files": [
      {
        "overwrite": true,
        "path": "/etc/hostname",
        "user": {
          "name": "root"
        },
        "contents": {
          "source": "data:,worker01.ocpcsm.hanabank.com"
        },
        "mode": 384
      }
    ]
  }
# ì¶”ê°€
}

cp w1.ign w2.ign
```

ì´ê·¸ë‹ˆì…˜ íŒŒì¼ ê¶Œí•œ ìˆ˜ì •

```bash
chmod 777 /var/www/html/ocp/*.ign
```

## 12. CoreOS node ì„¤ì¹˜

### 12-1. bootstrap ì„¤ì¹˜

bootstrap VM CoreOS ë¶€íŒ… â†’ IP ë° í˜¸ìŠ¤íŠ¸ë„¤ì„ ê¸°ë³¸ ì„¤ì • í›„

```bash
nmtui
Profile Name -> ens192
Addresses 10.229.111.64/24
Gateway 10.229.111.1
DNS Servers 10.229.111.32
10.229.111.33
-> í¬íŠ¸ ì¬ì‹œì‘
bash
# hostname í™•ì¸ bootstrap.ocpcsm.hanabank.com(DNSì—ì„œ ê°€ì ¸ì˜´)
sudo coreos-installer install /dev/sda -I <http://10.229.111.31:8080/ocp/b.ign> --insecure-ignition -n
# Install complete. í™•ì¸ í›„
reboot
```

bastion ë…¸ë“œì—ì„œ bootstraping ì§„í–‰ í™•ì¸

```bash
openshift-install wait-for bootstrap-complete --dir=/var/www/html/ocp --log-level debug
# ë¡œê·¸ í™•ì¸
DEBUG OpenShift Installer 4.11.18                  
DEBUG Built from commit 050fa95f79d92161df16578870ecd2764ab7a38e 
INFO Waiting up to 20m0s (until 5:05PM) for the Kubernetes API at <https://api.ocpcsm.hanabank.com:6443>... 
INFO API v1.24.6+5658434 up                       
DEBUG Loading Install Config...                    
DEBUG   Loading SSH Key...                         
DEBUG   Loading Base Domain...                     
DEBUG     Loading Platform...                      
DEBUG   Loading Cluster Name...                    
DEBUG     Loading Base Domain...                   
DEBUG     Loading Platform...                      
DEBUG   Loading Networking...                      
DEBUG     Loading Platform...                      
DEBUG   Loading Pull Secret...                     
DEBUG   Loading Platform...                        
DEBUG Using Install Config loaded from state file  
INFO Waiting up to 30m0s (until 5:15PM) for bootstrapping to complete...
# ì¶œë ¥ í›„ ë§ˆìŠ¤í„° ë…¸ë“œ ë°°í¬ ì‹œì‘
```

### 12-2. master node ì„¤ì¹˜

master node VM CoreOS ë¶€íŒ… â†’ IP ë° í˜¸ìŠ¤íŠ¸ë„¤ì„ ê¸°ë³¸ ì„¤ì • í›„

```bash
nmtui
Profile Name -> ens192
Addresses 10.229.111.51/24
Gateway 10.229.111.1
DNS Servers 10.229.111.32
10.229.111.33
-> í¬íŠ¸ ì¬ì‹œì‘
bash
# hostname í™•ì¸ master01.ocpcsm.hanabank.com
sudo coreos-installer install /dev/sda -I <http://10.229.111.31:8080/ocp/m1.ign> --insecure-ignition -n
# Install complete. í™•ì¸ í›„
reboot

nmtui
Profile Name -> ens192
Addresses 10.229.111.52/24
Gateway 10.229.111.1
DNS Servers 10.229.111.32
10.229.111.33
-> í¬íŠ¸ ì¬ì‹œì‘
bash
# hostname í™•ì¸ master02.ocpcsm.hanabank.com
sudo coreos-installer install /dev/sda -I <http://10.229.111.31:8080/ocp/m2.ign> --insecure-ignition -n
# Install complete. í™•ì¸ í›„
reboot

nmtui
Profile Name -> ens192
Addresses 10.229.111.53/24
Gateway 10.229.111.1
DNS Servers 10.229.111.32
10.229.111.33
-> í¬íŠ¸ ì¬ì‹œì‘
bash
# hostname í™•ì¸ master03.ocpcsm.hanabank.com
sudo coreos-installer install /dev/sda -I <http://10.229.111.31:8080/ocp/m3.ign> --insecure-ignition -n
# Install complete. í™•ì¸ í›„
reboot
```

bastion ë…¸ë“œì—ì„œ master node ì„¤ì¹˜ ì§„í–‰ í™•ì¸ â†’ ë§ˆìŠ¤í„° ë…¸ë“œ 3ëŒ€(ë³€ê²½ ë¶ˆê°€) ë°°í¬(Ready) í›„ worker node ë°°í¬

```bash
export KUBECONFIG=/var/www/html/ocp/auth/kubeconfig
# ëª…ë ¹ì–´ ë“±ë¡(env í™•ì¸í•˜ê¸°)
||
cp /var/www/html/ocp/auth/kubeconfig ~/.kube/config
# ëª…ë ¹ì–´ ë“±ë¡(ì˜êµ¬ ë“±ë¡)
oc get node
# ì„¤ì¹˜ëœ node í™•ì¸
NAME                           STATUS   ROLES    AGE    VERSION
master01.ocpcsm.hanabank.com   Ready    master   12m   v1.24.6+5658434
master02.ocpcsm.hanabank.com   Ready    master   11m   v1.24.6+5658434
master03.ocpcsm.hanabank.com   Ready    master   10m   v1.24.6+5658434
# ì¶œë ¥ê°’(STATUS -> Ready)
```

### 12-3. router node ì„¤ì¹˜

router node VM CoreOS ë¶€íŒ… â†’ IP ë° í˜¸ìŠ¤íŠ¸ë„¤ì„ ê¸°ë³¸ ì„¤ì • í›„

```bash
nmtui
Profile Name -> ens192
Addresses 10.229.111.57/24
Gateway 10.229.111.1
DNS Servers 10.229.111.32
10.229.111.33
-> í¬íŠ¸ ì¬ì‹œì‘
bash
# hostname í™•ì¸ router01.ocpcsm.hanabank.com
sudo coreos-installer install /dev/sda -I <http://10.229.111.31:8080/ocp/r1.ign> --insecure-ignition -n
# Install complete. í™•ì¸ í›„
reboot

nmtui
Profile Name -> ens192
Addresses 10.229.111.58/24
Gateway 10.229.111.1
DNS Servers 10.229.111.32
10.229.111.33
-> í¬íŠ¸ ì¬ì‹œì‘
bash
# hostname í™•ì¸ router02.ocpcsm.hanabank.com
sudo coreos-installer install /dev/sda -I <http://10.229.111.31:8080/ocp/r2.ign> --insecure-ignition -n
# Install complete. í™•ì¸ í›„
reboot
```

### 12-4. worker node ì„¤ì¹˜

worker node VM CoreOS ë¶€íŒ… â†’ IP ë° í˜¸ìŠ¤íŠ¸ë„¤ì„ ê¸°ë³¸ ì„¤ì • í›„

```bash
nmtui
Profile Name -> ens192
Addresses 10.229.111.62/24
Gateway 10.229.111.1
DNS Servers 10.229.111.32
10.229.111.33
-> í¬íŠ¸ ì¬ì‹œì‘
bash
# hostname í™•ì¸ worker01.ocpcsm.hanabank.com
sudo coreos-installer install /dev/sda -I <http://10.229.111.31:8080/ocp/w1.ign> --insecure-ignition -n
# Install complete. í™•ì¸ í›„
reboot

nmtui
Profile Name -> ens192
Addresses 10.229.111.63/24
Gateway 10.229.111.1
DNS Servers 10.229.111.32
10.229.111.33
-> í¬íŠ¸ ì¬ì‹œì‘
bash
# hostname í™•ì¸ worker02.ocpcsm.hanabank.com
sudo coreos-installer install /dev/sda -I <http://10.229.111.31:8080/ocp/w2.ign> --insecure-ignition -n
# Install complete. í™•ì¸ í›„
reboot
```

csr(certificate signing request) ìŠ¹ì¸(worker ë…¸ë“œëŠ” csr ìŠ¹ì¸ í›„ ë…¸ë“œ join)

```bash
oc get csr
# csr í™•ì¸
# CONDITION -> Pending
oc adm certificate approve csr-h4kcs
# Pending ìƒíƒœ ìŠ¹ì¸
||
oc get csr -o go-template='{{range .items}}{{if not .status}}{{.metadata.name}}{{"\\n"}}{{end}}{{end}}' | xargs oc adm certificate approve
```

------

# ì„¤ì¹˜ í™•ì¸

## 13. ìƒíƒœ í™•ì¸

### 13-1. ë…¸ë“œ ìƒíƒœ í™•ì¸

```bash
NAME                           STATUS   ROLES    AGE    VERSION
master01.ocpcsm.hanabank.com   Ready    master   31m   v1.24.6+5658434
master02.ocpcsm.hanabank.com   Ready    master   30m   v1.24.6+5658434
master03.ocpcsm.hanabank.com   Ready    master   28m   v1.24.6+5658434
router01.ocpcsm.hanabank.com   Ready    worker   12m   v1.24.6+5658434
router02.ocpcsm.hanabank.com   Ready    worker   11m   v1.24.6+5658434
worker01.ocpcsm.hanabank.com   Ready    worker   7m   v1.24.6+5658434
worker02.ocpcsm.hanabank.com   Ready    worker   8m   v1.24.6+5658434
```

### 13-2. cluseteroperator í™•ì¸(ìŠ¤ëƒ…ìƒ·)

ì „ oc AVAILABLE â†’ True / PROGRESSING â†’ False

```bash
NAME                                       VERSION   AVAILABLE   PROGRESSING   DEGRADED   SINCE   MESSAGE
authentication                             4.11.18   True        False         False      101m    
baremetal                                  4.11.18   True        False         False      125m    
cloud-controller-manager                   4.11.18   True        False         False      130m    
cloud-credential                           4.11.18   True        False         False      141m    
cluster-autoscaler                         4.11.18   True        False         False      125m    
config-operator                            4.11.18   True        False         False      128m    
console                                    4.11.18   True        False         False      106m    
csi-snapshot-controller                    4.11.18   True        False         False      113m    
dns                                        4.11.18   True        False         False      125m    
etcd                                       4.11.18   True        False         False      125m    
image-registry                             4.11.18   True        False         False      119m    
ingress                                    4.11.18   True        False         False      108m    
insights                                   4.11.18   True        False         False      53s     
kube-apiserver                             4.11.18   True        False         False      123m    
kube-controller-manager                    4.11.18   True        False         False      122m    
kube-scheduler                             4.11.18   True        False         False      123m    
kube-storage-version-migrator              4.11.18   True        False         False      127m    
machine-api                                4.11.18   True        False         False      125m    
machine-approver                           4.11.18   True        False         False      125m    
machine-config                             4.11.18   True        False         False      124m    
marketplace                                4.11.18   True        False         False      125m    
monitoring                                 4.11.18   True        False         False      103m    
network                                    4.11.18   True        False         False      124m    
node-tuning                                4.11.18   True        False         False      125m    
openshift-apiserver                        4.11.18   True        False         False      112m    
openshift-controller-manager               4.11.18   True        False         False      123m    
openshift-samples                          4.11.18   True        False         False      109m    
operator-lifecycle-manager                 4.11.18   True        False         False      126m    
operator-lifecycle-manager-catalog         4.11.18   True        False         False      126m    
operator-lifecycle-manager-packageserver   4.11.18   True        False         False      113m    
service-ca                                 4.11.18   True        False         False      127m    
storage                                    4.11.18   True        False         False      128m    
```

## 14. ì ‘ì† í™•ì¸

### 14-1. ì ‘ì† URL í™•ì¸

hostsì— ë“±ë¡í•  ë„ë©”ì¸ í™•ì¸

```bash
oc get route -A
# ëª¨ë“  ë…¸ë“œ ë‚˜ì—´
NAMESPACE                  NAME                      HOST/PORT                                                               PATH        SERVICES            PORT    TERMINATION            WILDCARD
openshift-authentication   oauth-openshift           oauth-openshift.apps.ocpcsm.hanabank.com                                            oauth-openshift     6443    passthrough/Redirect   None
openshift-console          console                   console-openshift-console.apps.ocpcsm.hanabank.com                                  console             https   reencrypt/Redirect     None
# hostsì— ë“±ë¡í•  í•­ëª© í™•ì¸ oauth -> ocp ê³„ì • ì¸ì¦ ê´€ë ¨, console -> ì›¹ì½˜ì†” ë„ë©”ì¸
```

### 14-2. hosts ë“±ë¡

ìœˆë„ìš° â†’C:\Windows\System32\drivers\etc\hosts / ë¦¬ëˆ…ìŠ¤ â†’ /etc/hosts

```bash
10.229.111.31 oauth-openshift.apps.ocpcsm.hanabank.com
10.229.111.31 console-openshift-console.apps.ocpcsm.hanabank.com
```

### 14-3. Web Console ì ‘ì†

ì›¹ ë¸Œë¼ìš°ì €

```bash
<https://console-openshift-console.apps.ocpcsm.hanabank.com>
```

ê¸°ë³¸ ID / PW í™•ì¸

```bash
ì‚¬ìš©ì ì´ë¦„ : kubeadmin (default)
ì•”í˜¸ : [cat /var/www/html/ocp/auth/kubeadmin-passwordì—ì„œ í™•ì¸ ê°€ëŠ¥]
```